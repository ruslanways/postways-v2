{% extends 'diary/base.html' %}

{% block title %} author#{{object.pk}} {{ object.username }} {% endblock %}

{% block content %}

<div class="container">
  <div class="profile-header">
    <div class="profile-details">
      <h3 class="profile-username">{{ object.username }}</h3>
      {% if user.is_authenticated and user.pk == object.pk %}
        <p class="profile-email">{{ object.email }}</p>
      {% endif %}
      <p class="profile-stats">
        Member since {{ object.date_joined|date:"M Y" }}
      </p>
      <p class="profile-posts">
        {% with post_count=object.post_set.count %}
          {% if post_count == 0 %}No posts yet{% elif post_count == 1 %}1 post{% else %}{{ post_count }} posts{% endif %}
        {% endwith %}
      </p>
      <p class="profile-likes">
        <span class="heart">♥</span>
        {% if object.likes_received == 1 %}1 like{% else %}{{ object.likes_received }} likes{% endif %} received
      </p>
      {% if object.last_request %}
        {% if user.is_staff or user.is_authenticated and user.pk == object.pk %}
          <p class="profile-activity">
            Active {{ object.last_request|timesince }} ago
          </p>
        {% endif %}
      {% endif %}
    </div>
    {% if user.is_authenticated and user.pk == object.pk %}
      <div class="profile-actions">
        <a class="btn btn-secondary btn-sm {% if view.template_name == 'registration/email_change.html' %}active{% endif %}" href="{% url 'email_change' %}">Change Email</a>
        <a class="btn btn-secondary btn-sm {% if view.template_name == 'registration/username_change.html' %}active{% endif %}" href="{% url 'username_change' %}">Change Username</a>
        <a class="btn btn-secondary btn-sm {% if view.template_name == 'registration/password_change_form.html' %}active{% endif %}" href="{% url 'password_change' %}">Change Password</a>
        <a class="btn btn-danger btn-sm {% if view.template_name == 'diary/user-delete.html' %}active{% endif %}" href="{% url 'user-delete' user.pk %}">Delete Account</a>
      </div>
    {% endif %}
  </div>
</div>

<div class="posts-grid">
  {% for post in page_obj %}
    <article class="post-card">
      <div class="post-card-header">
        {% if post.image %}
          <a href="{% url 'post-detail' post.pk %}">
            <img src="{% if post.thumbnail %}{{ post.thumbnail.url }}{% else %}{{ post.image.url }}{% endif %}" 
                 alt="{{ post.title }}" 
                 class="post-card-image">
          </a>
        {% endif %}
        <div class="post-card-content">
          <h3 class="post-card-title">
            <a href="{% url 'post-detail' post.pk %}">{{ post.title }}</a>
          </h3>
          <div class="post-card-meta">
            <span class="post-card-date">
              {{ post.created|date }} at {{ post.created|time:"H:i" }}
            </span>
            {% if not post.published %}
              <span class="text-muted">*unpublished</span>
            {% endif %}
            {% if user.is_authenticated and post.id in liked_by_user %}
              <a href="{% url 'like-toggle-api' %}" id="{{ post.id }}" class="like is-liked">
                <span class="heart">♥</span>
                <span class="count">{{ post.like__count }}</span>
              </a>
            {% elif user.is_authenticated %}
              <a href="{% url 'like-toggle-api' %}" id="{{ post.id }}" class="like">
                <span class="heart">♡</span>
                <span class="count">{{ post.like__count }}</span>
              </a>
            {% else %}
              <a href="{% url 'login' %}" id="{{ post.id }}" class="like">
                <span class="heart">♡</span>
                <span class="count">{{ post.like__count }}</span>
              </a>
            {% endif %}
          </div>
          <p class="post-card-excerpt">
            <a href="{% url 'post-detail' post.pk %}">
              {{ post.content|truncatechars:150 }}
            </a>
          </p>
        </div>
      </div>
    </article>
  {% endfor %}
</div>

{% endblock %}
