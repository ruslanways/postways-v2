{% extends 'diary/base.html' %}

{% block title %} Posts {% endblock %}

{% block content %}

<div class="posts-grid">
  {% for post in object_list %}
    <article class="post-card">
      <div class="post-card-header">
        {% if post.image %}
          <a href="{% url 'post-detail' post.pk %}">
            <img src="{% if post.thumbnail %}{{ post.thumbnail.url }}{% else %}{{ post.image.url }}{% endif %}" 
                 alt="{{ post.title }}" 
                 class="post-card-image">
          </a>
        {% endif %}
        <div class="post-card-content">
          <h3 class="post-card-title">
            <a href="{% url 'post-detail' post.pk %}">{{ post.title }}</a>
          </h3>
          <div class="post-card-meta">
            <a href="{% url 'author-detail' post.author.pk %}" class="post-card-author">
              {{ post.author.username }}
            </a>
            <span class="post-card-date">
              {{ post.created|date }} at {{ post.created|time:"H:i" }}
            </span>
            {% if not post.published %}
              <span class="text-muted">*unpublished</span>
            {% endif %}
            {% if user.is_authenticated and post.id in liked_by_user %}
              <a href="{% url 'like-toggle-api' %}" id="{{ post.id }}" class="like is-liked">
                <span class="heart">♥</span>
                <span class="count">{{ post.like__count }}</span>
              </a>
            {% elif user.is_authenticated %}
              <a href="{% url 'like-toggle-api' %}" id="{{ post.id }}" class="like">
                <span class="heart">♡</span>
                <span class="count">{{ post.like__count }}</span>
              </a>
            {% else %}
              <a href="{% url 'login' %}" id="{{ post.id }}" class="like">
                <span class="heart">♡</span>
                <span class="count">{{ post.like__count }}</span>
              </a>
            {% endif %}
          </div>
          <p class="post-card-excerpt">
            <a href="{% url 'post-detail' post.pk %}">
              {{ post.content|truncatechars:150 }}
            </a>
          </p>
        </div>
      </div>
    </article>
  {% endfor %}
</div>

{% endblock %}
