{% extends 'diary/base.html' %}
{% load diary_tags %}

{% block title %} update post {% endblock %}

{% block content %}

<div class="form-container form-container--post">
  <h1>Update Post</h1>

  <form method="post" enctype="multipart/form-data">
    {% csrf_token %}

    {{ form.non_field_errors }}

    <div class="form-group">
      <label for="{{ form.title.id_for_label }}" class="form-label">{{ form.title.label }}</label>
      {{ form.title }}
      {% if form.title.errors %}
        <div class="form-errors">{{ form.title.errors }}</div>
      {% endif %}
    </div>

    <div class="form-group">
      <label for="{{ form.content.id_for_label }}" class="form-label">{{ form.content.label }}</label>
      {{ form.content }}
      {% if form.content.errors %}
        <div class="form-errors">{{ form.content.errors }}</div>
      {% endif %}
    </div>

    <div class="form-group">
      <label for="{{ form.image.id_for_label }}" class="form-label">{{ form.image.label }}</label>
      {% if form.instance.image %}
        <div class="form-current-file">
          <span class="form-current-file__label">Current:</span>
          <span class="form-current-file__name">{{ form.instance.image.name|filename }}</span>
        </div>
        <label class="form-checkbox-label form-clear-checkbox">
          <input type="checkbox" name="image-clear" id="image-clear_id" class="form-checkbox">
          <span>Clear the image</span>
        </label>
      {% endif %}
      <input type="file" name="image" accept="image/*" class="form-input" id="id_image">
      {% if form.image.help_text %}
        <span class="form-help-text">{{ form.image.help_text }}</span>
      {% endif %}
      {% if form.image.errors %}
        <div class="form-errors">{{ form.image.errors }}</div>
      {% endif %}
    </div>

    <div class="form-group">
      <label class="form-checkbox-label">
        {{ form.published }}
        <span>{{ form.published.label }}</span>
      </label>
      {% if form.published.errors %}
        <div class="form-errors">{{ form.published.errors }}</div>
      {% endif %}
    </div>

    <div class="form-actions">
      <button type="submit" class="btn btn-primary">Update</button>
      <a href="{% url 'post-detail' form.instance.pk %}" class="btn btn-secondary">Cancel</a>
    </div>
  </form>
</div>

<script>
(function() {
  const MAX_IMAGE_SIZE_MB = 10;
  const MAX_IMAGE_SIZE_BYTES = MAX_IMAGE_SIZE_MB * 1024 * 1024;

  const imageInput = document.querySelector('input[type="file"]');
  if (!imageInput) return;

  imageInput.addEventListener('change', function() {
    const file = this.files[0];
    if (file && file.size > MAX_IMAGE_SIZE_BYTES) {
      alert('Image file too large. Maximum size is ' + MAX_IMAGE_SIZE_MB + ' MB.\nYour file: ' + (file.size / 1024 / 1024).toFixed(1) + ' MB');
      this.value = '';
    }
  });
})();
</script>

{% endblock %}
